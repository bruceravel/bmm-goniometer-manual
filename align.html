

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>4. Goniometer alignment for XRR &#8212; BMM Goniometer Manual 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'align';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. X-ray Reflectivity" href="xrr.html" />
    <link rel="prev" title="3. Detectors" href="detectors.html" />

    <link rel="stylesheet" type="text/css" href="_static/demeter.css" />
    <link rel="stylesheet" type="text/css" href="_static/keys.css" />
    <link rel="stylesheet" type="text/css" href="_static/program.css" />
    <link rel="stylesheet" type="text/css" href="_static/color.css" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/floor_mat.png" class="logo__image only-light" alt="BMM Goniometer Manual 0.1 documentation - Home"/>
    <script>document.write(`<img src="_static/floor_mat.png" class="logo__image only-dark" alt="BMM Goniometer Manual 0.1 documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User documentation</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction to BMM</a></li>
<li class="toctree-l1"><a class="reference internal" href="coordinated.html">2. Motors and Coordinated Motions</a></li>
<li class="toctree-l1"><a class="reference internal" href="detectors.html">3. Detectors</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. Goniometer alignment for XRR</a></li>
<li class="toctree-l1"><a class="reference internal" href="xrr.html">5. X-ray Reflectivity</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheatsheet.html">6. Command cheatsheet</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NSLS2/bmm-goniometer-manual" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NSLS2/bmm-goniometer-manual/issues/new?title=Issue%20on%20page%20%2Falign.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/align.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Goniometer alignment for XRR</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xrd-mode-of-the-photon-delivery-system">4.1. XRD mode of the Photon Delivery System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-beam-camera">4.2. Direct beam camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slit-alignment">4.3. Slit alignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#horizontal-detector-alignment">4.4. Horizontal detector alignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mythen-calibration">4.5. Mythen Calibration</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  
<style>
  .ss-layout-default-AB { grid-template-areas: 'A B'; }
@media (max-width: 576px) {
  .ss-layout-sm-AB { grid-template-areas: 'A B'; }
}
</style>
<section id="goniometer-alignment-for-xrr">
<span id="align"></span><h1><span class="section-number">4. </span>Goniometer alignment for XRR<a class="headerlink" href="#goniometer-alignment-for-xrr" title="Permalink to this heading">#</a></h1>
<p>To start, place the Mythen in the most downstream position on the
<span class="olive">(what is the arm called?)</span> Measure and record the gap value –
typically around 90 mm.  See <a class="reference internal" href="#fig-gap"><span class="std std-numref">Figure 4.5</span></a> for a photo
identifying what the gap is.</p>
<section id="xrd-mode-of-the-photon-delivery-system">
<h2><span class="section-number">4.1. </span>XRD mode of the Photon Delivery System<a class="headerlink" href="#xrd-mode-of-the-photon-delivery-system" title="Permalink to this heading">#</a></h2>
<div class="admonition-future-tech admonition">
<p class="admonition-title">Future Tech!</p>
<p>Implement <code class="docutils literal notranslate"><span class="pre">change_edge()</span></code> in this profile.</p>
<p>Also need to explain how to use that to change energy</p>
</div>
</section>
<section id="direct-beam-camera">
<h2><span class="section-number">4.2. </span>Direct beam camera<a class="headerlink" href="#direct-beam-camera" title="Permalink to this heading">#</a></h2>
<p>Attach the mounting bracker for the direct beam camera to its mount
point on the floor, as shown in <a class="reference internal" href="#fig-yag"><span class="std std-numref">Figure 4.1</span></a>.  When
securing the mounting bracket to the floor, slide the spacing plate
between the bracket’s horizontal member and the counterweight of the
mu circle.  This assures that the goniometer table moves freely during
alignment and that the camera is close to the correct height relative
to the beam.</p>
<figure class="align-center" id="id2">
<span id="fig-yag"></span><a class="reference external image-reference" href="_images/dummy.png"><img alt="_images/dummy.png" src="_images/dummy.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.1 </span><span class="caption-text">The mount for the direct beam camera</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Once the direct beam camera is in place and powered up, turn the
analog video switch to the correct setting.  This switch is on the XAS
control station, as shown in <a class="reference internal" href="#fig-anacam-switch"><span class="std std-numref">Figure 4.2</span></a>.
Also mount the alignment pin on the goniometer head.</p>
<figure class="sphinx-subfigure align-default" id="fig-anacam-switch">
<div class="sphinx-subfigure-grid ss-layout-default-AB ss-layout-sm-AB outline" style="display: grid; gap: 8px; grid-gap: 8px;">
<div class="sphinx-subfigure-area" style="display: flex; flex-direction: column; justify-content: center; align-items: center; grid-area: A;">
<img alt="_images/dummy.png" src="_images/dummy.png" />
</div>
<div class="sphinx-subfigure-area" style="display: flex; flex-direction: column; justify-content: center; align-items: center; grid-area: B;">
<img alt="_images/analog_switch.jpg" src="_images/analog_switch.jpg" />
</div>
</div>
<figcaption>
<p><span class="caption-number">Fig. 4.2 </span><span class="caption-text">(Left) The aligment pin mounted on the goniometer head.  (Right)
The switch for analog video signals.</span><a class="headerlink" href="#fig-anacam-switch" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Verify that the direct beam hits the camera, then evaluate the size
and shape of the beam. You may want to apply some attenuation to the
beam – the YAG crystal bleeds at high flux, making it hard to
assess the actual size and shape of the beam.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">attenuator</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>The beam should be a small oval with the axes of the oval parallel and
perpendicular to gravity.  If the oval is slanted, try adjusting the
yaw of the focusing mirror (<a class="reference internal" href="coordinated.html#focusing-mirror"><span class="std std-numref">See Section 2.5.3</span></a>), for example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">yaw</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">))</span>
</pre></div>
</div>
<p>With the shadow of the pin in the focused, direct beam, note its
position on screen.  Rotate the phi axis by 180 degrees.  Note the new
position.  Find the center point of these two positions and move
<code class="docutils literal notranslate"><span class="pre">table.lateral</span></code> to place the center of the beam at that center
point using command like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">lateral</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
</pre></div>
</div>
<p>Rotate the chi circle by -90 degrees so that the pin is in the
horizontal plane.  Repeat the procedure of noting the position,
rotating phi by 180 degrees, and finding the center point.  Place the
beam at the center point by doing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">vertical</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
</pre></div>
</div>
<p>Read and record the table motor positions.</p>
<p>See <a class="reference internal" href="coordinated.html#goniometer-table"><span class="std std-numref">Section 2.4</span></a> for details of table
movement.</p>
<div class="admonition-future-tech admonition">
<p class="admonition-title">Future Tech!</p>
<p>Direct beam camera that can be read via AreaDetector.  Do image
analysis on shadow of pin to compute correct <code class="docutils literal notranslate"><span class="pre">table.vertical</span></code> and
<code class="docutils literal notranslate"><span class="pre">table.lateral</span></code> positions.</p>
</div>
</section>
<section id="slit-alignment">
<span id="slit-align"></span><h2><span class="section-number">4.3. </span>Slit alignment<a class="headerlink" href="#slit-alignment" title="Permalink to this heading">#</a></h2>
<p>Open the slits to their fully open position:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">slits</span><span class="o">.</span><span class="n">hsize</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">slits</span><span class="o">.</span><span class="n">vsize</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
<p>The direct beam should still be visible on the direct beam camera.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>What to do if the beam is not near the center of the slits?</p>
</div>
<p>To align and calibrate the goniometer slits, do</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">align_slits</span><span class="p">())</span>
</pre></div>
</div>
<p>The optional arguments to this plan are</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">nsteps</span></code></dt><dd><p>Number of steps in each scan (default is 31)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">move</span></code></dt><dd><p>If True, move to the centroid (default is True)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">calibrate</span></code></dt><dd><p>If True, reset offset so that centroid is at 0</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inttime</span></code></dt><dd><p>Scan dwell time (default is 0.5 seconds)</p>
</dd>
</dl>
<p>The slit alignment procedure will run a linescan <span class="olive">(need link to
linescan explanation)</span> on each of the four slits individually,
plotting the signal on the monitor <span class="olive">(need link to monitor
explanation)</span> versus slit position.  This signal should be a step-like
function, so the result is fit to an error function.  The slit is
moved to the centroid of the fitted error function and the offset of
the slit is reset to define the zero position.  The result of an
individual slit scan looks like <a class="reference internal" href="#fig-slitscan"><span class="std std-numref">Figure 4.3</span></a>.</p>
<figure class="align-center" id="id3">
<span id="fig-slitscan"></span><a class="reference external image-reference" href="_images/slit_bot.png"><img alt="_images/slit_bot.png" src="_images/slit_bot.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.3 </span><span class="caption-text">The fit to an individual slit scan, in this case, bottom blade.</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Once aligned and calibrated, set the slit size for the experiment,
something like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">slits</span><span class="o">.</span><span class="n">hsize</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">mvr</span><span class="p">(</span><span class="n">slits</span><span class="o">.</span><span class="n">vsize</span><span class="p">,</span> <span class="mf">0.120</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="horizontal-detector-alignment">
<span id="dethor-align"></span><h2><span class="section-number">4.4. </span>Horizontal detector alignment<a class="headerlink" href="#horizontal-detector-alignment" title="Permalink to this heading">#</a></h2>
<p>With the beam in the center of the goniometer and in the center of the
slits, we next align the Mythen with the direct beam.  To do so, we
perform a linescan of the <code class="docutils literal notranslate"><span class="pre">dethor</span></code> axis, moving the detector across
the incident beam.</p>
<p>The attenuator needs to be set to a value suitable for the incident
beam, something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">attenuator</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
<p>then perform a linescan of the dethor motor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">linescan</span><span class="p">(</span><span class="n">dethor</span><span class="p">,</span> <span class="s1">&#39;mythen&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
</pre></div>
</div>
<p>The live plot will show the progress of the scan.  Once the scan is
finished, some simple peak interpretation is performed, shown in
<a class="reference internal" href="#fig-dethor"><span class="std std-numref">Figure 4.4</span></a>.</p>
<p>The peak-like shape is reduced to find the peak, the center of mass
(the “com”), and the center of the full width at half maximum
(the “cen”).  In this case, <code class="docutils literal notranslate"><span class="pre">dethor</span></code> is moved to the cen value.</p>
<figure class="align-center" id="id4">
<span id="fig-dethor"></span><a class="reference external image-reference" href="_images/dethor.png"><img alt="_images/dethor.png" src="_images/dethor.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.4 </span><span class="caption-text">Interpretation of the horizontal scan of <code class="docutils literal notranslate"><span class="pre">dethor</span></code> to center the
Mythen on the incident beam.</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>At this point, take a count on the Mythen to find the position of the
direct beam on the detector.  Set the dwell_time to something short
and do an exposure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">dwell_time</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">mythen</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>The signal from the exposure will have a peak centered on some pixel.
If the slits are 120 μm, then the direct beam will illuminate 3
or 4 strips, as the strip width is 50 μm, as shown on the
<a class="reference external" href="https://dectris.com/en/detectors/x-ray-detectors/mythen2/mythen2-for-synchrotrons/">Mythen2 specification sheet</a>
and there 1280 strips on the detector.</p>
<p>The direct beam should be around the 200<sup>th</sup> strip.  Adjust the
gap on the flight path holder so that is approximately true.  A simple
calculation of the center of the illuminated area from the count will
be good enough. This places the beam closer to the bottom of the
detector, thus most of the strips are above the direct beam – also,
then, the reflected beam in an XRR experiment.  See <a class="reference internal" href="#fig-gap"><span class="std std-numref">Figure 4.5</span></a>.</p>
<figure class="align-center" id="id5">
<span id="fig-gap"></span><a class="reference external image-reference" href="_images/gap.jpg"><img alt="_images/gap.jpg" src="_images/gap.jpg" style="width: 75%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.5 </span><span class="caption-text">The gap measures the elevation of the Mythen and
its flight path on the hand-operated vertical jack.</span><a class="headerlink" href="#id5" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="mythen-calibration">
<span id="mythen-cal"></span><h2><span class="section-number">4.5. </span>Mythen Calibration<a class="headerlink" href="#mythen-calibration" title="Permalink to this heading">#</a></h2>
<p>With the beam around strip 200, run a linescan of delta, plotting the
signal from the full MCA spectrum from the Mythen.  This will be
dominated by the integral under the 3 or 4 strip wide peak due to the
direct beam.</p>
<p>This scan will find the extent of the detector in delta.  As the beam
passes over the detector, the signal will be approximately constant.</p>
<p>Typical scan parameters are:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mythen_calibration</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1001</span><span class="p">))</span>
</pre></div>
</div>
<p>The optional arguments to <code class="docutils literal notranslate"><span class="pre">mythen_calibration</span></code> are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">start</span></code></dt><dd><p>From delta=0, the starting angle of the scan, in degrees</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stop</span></code></dt><dd><p>From delta=0, the ending position of the scan, in degrees</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nsteps</span></code></dt><dd><p>The number of steps in the scan</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inttime</span></code></dt><dd><p>The dwell time at each point in the scan. Default is 0.1 seconds</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">force</span></code></dt><dd><p>When true, force the scan to run even if the beamline is not ready
(e.g. no beam). Default is False.</p>
</dd>
</dl>
<p>The live plot will look something like <a class="reference internal" href="#fig-mythencal"><span class="std std-numref">Figure 4.6</span></a>.</p>
<figure class="align-center" id="id6">
<span id="fig-mythencal"></span><a class="reference external image-reference" href="_images/mythen_cal.png"><img alt="_images/mythen_cal.png" src="_images/mythen_cal.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.6 </span><span class="caption-text">A liveplot of the Mythen full MCA integration versus delta angle.</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>When the linescan in delta is finished, some data reduction happens
and a report is generated.  This report is written to the screen.  It
is also written to a PowerPoint file in the data folder.  It’s
contents look something like <a class="reference internal" href="#fig-calibration-report"><span class="std std-numref">Figure 4.7</span></a>.</p>
<figure class="align-center" id="id7">
<span id="fig-calibration-report"></span><a class="reference external image-reference" href="_images/calibration_report.png"><img alt="_images/calibration_report.png" src="_images/calibration_report.png" style="width: 95%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.7 </span><span class="caption-text">An image of the PowerPoint report made on the Mythen calibration
scan.  (Note: there are some obvious errors in this picture.
Picture will be updated once the report is fixed.)</span><a class="headerlink" href="#id7" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In the upper right corner of this report, the path to the proposal
folder is written as is the UID of the Tiled record.  The numerical
results of the fit are given in the main text.  A plot of fit to the
beam position on the detector is shown in the plot.  Form this fit, we
get the formula for mapping delta angle to direct beam detector
position, as well as values for the gap, the distance form the
goniometer eucentric to the detector, and the pixel underneath the
direct beam at delta=0.</p>
<p>Once this analysis is finished, the ROIs for the direct and reflected
beam are set.  Those values and the slits sizes are also in the
report.</p>
<p>You can visualize the ROIs over the direct beam spectrum by moving
delta to 0, doing a count, then plotting the spectrum just counted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RE</span><span class="p">(</span><span class="n">mv</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">RE</span><span class="p">(</span><span class="n">count</span><span class="p">([</span><span class="n">mythen</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">mythen</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>The value of N in the <code class="docutils literal notranslate"><span class="pre">mythen.plot</span></code> function identifies which ROI
will be shown in the plot.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">mythen.plot(0)</span></code></dt><dd><p>This will show the full MCA spectrum ROI, i.e. the entire detector</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mythen.plot(1)</span></code></dt><dd><p>This will show the direct beam ROI.  As this is only a few strips
wide, it is hard to see at full scale.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mythen.plot(2)</span></code></dt><dd><p>This will show the reflected beam ROI.  This is still quite narrow,
but more apparent than the direct beam ROI.</p>
</dd>
</dl>
<figure class="align-center" id="id8">
<span id="fig-directbeamroi"></span><a class="reference external image-reference" href="_images/dummy.png"><img alt="_images/dummy.png" src="_images/dummy.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.8 </span><span class="caption-text">A zoomed-in view of the direct beam ROI on top of the MCA spectrum,
made using <code class="docutils literal notranslate"><span class="pre">mythen.plot(1)</span></code>.</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>As a final check of the instrument alignment and the setting of the
detector ROIs, do a linescan with rather fine steps of delta.  The
live plot will show the direct beam ROI and the wider, reflected beam
ROI as functions of delta.  The narrower direct beam ROI should be
well centered within the reflected beam ROI.  If it is not, then
something about the instrument alignment or the setting of the ROIs
was done incorrectly.</p>
<p>At the end of the scan, the direct beam peak is interpreted for peak,
com, and cen positions.  The offset of the delta motor is reset so
that the cen is at 0.  This should be a very small change in offset.</p>
<figure class="align-center" id="id9">
<span id="fig-deltadirect"></span><a class="reference external image-reference" href="_images/delta_direct.png"><img alt="_images/delta_direct.png" src="_images/delta_direct.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4.9 </span><span class="caption-text">Showing the interpretation of the direct beam ROI as a function of
delta angle.  This should be narrow and centered very close to 0.
Note that the com and cen are at the same position.  This is a good
alignment!</span><a class="headerlink" href="#id9" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Capture a live plot image and make <a class="reference internal" href="#fig-deltadirect"><span class="std std-numref">Figure 4.9</span></a> a subfigure</p>
</div>

<br>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="detectors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Detectors</p>
      </div>
    </a>
    <a class="right-next"
       href="xrr.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>X-ray Reflectivity</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xrd-mode-of-the-photon-delivery-system">4.1. XRD mode of the Photon Delivery System</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#direct-beam-camera">4.2. Direct beam camera</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#slit-alignment">4.3. Slit alignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#horizontal-detector-alignment">4.4. Horizontal detector alignment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mythen-calibration">4.5. Mythen Calibration</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bruce Ravel
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>